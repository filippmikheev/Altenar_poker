<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            color: var(--text-light);
        }
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
        .admin-section h3 {
            color: var(--gold);
            margin-bottom: 15px;
        }
        .players-table, .rooms-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .players-table th, .players-table td,
        .rooms-table th, .rooms-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .players-table th, .rooms-table th {
            background: rgba(255, 215, 0, 0.2);
            color: var(--gold);
        }
        .admin-input {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.5);
            color: var(--text-light);
            width: 150px;
        }
        .admin-btn {
            padding: 8px 15px;
            background: var(--gold);
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }
        .admin-btn:hover {
            background: #ffd700;
        }
        .admin-btn-danger {
            background: #e74c3c;
            color: white;
        }
        .admin-btn-danger:hover {
            background: #c0392b;
        }
        .admin-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .admin-message.success {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }
        .admin-message.error {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }
        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            text-decoration: none;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <a href="/" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∫–µ—Ä—É</a>
        
        <div class="admin-header">
            <h1>üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ –∏ —Å—Ç–æ–ª–∞–º–∏</p>
        </div>

        <div id="adminMessage"></div>

        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div id="adminLoginForm" class="admin-section" style="display: none;">
            <h3>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
            <p style="margin-bottom: 15px;">–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞:</p>
            <div style="display: flex; flex-direction: column; gap: 10px; max-width: 400px;">
                <div>
                    <label style="display: block; margin-bottom: 5px;">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="adminLoginInput" class="admin-input" placeholder="admin" style="width: 100%;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px;">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="adminPasswordInput" class="admin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width: 100%;">
                </div>
                <button class="admin-btn" onclick="loginAsAdmin()" style="width: 100%;">–í–æ–π—Ç–∏</button>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 5px; font-size: 0.9em;">
                <strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–≥–∏–Ω—ã:</strong><br>
                ‚Ä¢ –õ–æ–≥–∏–Ω: <code>admin</code>, –ü–∞—Ä–æ–ª—å: <code>admin123</code><br>
                ‚Ä¢ –õ–æ–≥–∏–Ω: <code>filipp</code>, –ü–∞—Ä–æ–ª—å: <code>altenar2024</code>
            </div>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ -->
        <div class="admin-section">
            <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h3>
            <button class="admin-btn" onclick="loadPlayers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <table class="players-table">
                <thead>
                    <tr>
                        <th>–ò–º—è (Email)</th>
                        <th>–§–∏—à–∫–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–†–æ–ª—å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="playersTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∞–º–∏ -->
        <div class="admin-section">
            <h3>üé∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–∞–º–∏</h3>
            <button class="admin-btn" onclick="loadRooms()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <table class="rooms-table">
                <thead>
                    <tr>
                        <th>ID —Å—Ç–æ–ª–∞</th>
                        <th>–ò–≥—Ä–æ–∫–æ–≤</th>
                        <th>–°–æ—Å—Ç–æ—è–Ω–∏–µ</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="roomsTableBody">
                    <tr>
                        <td colspan="4" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const adminMessage = document.getElementById('adminMessage');
        const adminLoginForm = document.getElementById('adminLoginForm');
        let isAdminAuthenticated = false;

        socket.on('connect', () => {
            console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É');
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∞–¥–º–∏–Ω—Å–∫–∏–π –ª–æ–≥–∏–Ω
            const savedAdminLogin = localStorage.getItem('adminLogin');
            if (savedAdminLogin) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –≤—Ö–æ–¥–∏–º, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                adminLoginForm.style.display = 'block';
                document.getElementById('adminLoginInput').value = savedAdminLogin;
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
                adminLoginForm.style.display = 'block';
            }
        });

        socket.on('admin-authenticated', (data) => {
            if (data.success) {
                isAdminAuthenticated = true;
                adminLoginForm.style.display = 'none';
                showMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å!', 'success');
                loadPlayers();
                loadRooms();
            } else {
                showMessage(data.message || '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        });

        function loginAsAdmin() {
            const loginInput = document.getElementById('adminLoginInput');
            const passwordInput = document.getElementById('adminPasswordInput');
            const login = loginInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!login || !password) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            authenticateAdmin(login, password);
        }

        function authenticateAdmin(login, password) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–≥–∏–Ω (–Ω–æ –Ω–µ –ø–∞—Ä–æ–ª—å)
            localStorage.setItem('adminLogin', login);
            socket.emit('admin-authenticate', { login, password });
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
        document.addEventListener('DOMContentLoaded', () => {
            const loginInput = document.getElementById('adminLoginInput');
            const passwordInput = document.getElementById('adminPasswordInput');
            if (loginInput) {
                loginInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        passwordInput.focus();
                    }
                });
            }
            if (passwordInput) {
                passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        loginAsAdmin();
                    }
                });
            }
        });

        socket.on('admin-players-list', (players) => {
            const tbody = document.getElementById('playersTableBody');
            tbody.innerHTML = '';
            
            if (players.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">–ù–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</td></tr>';
                return;
            }
            
            players.forEach(player => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${player.name}</td>
                    <td>
                        <input type="number" class="admin-input" id="chips_${player.name}" value="${player.chips}" min="0">
                    </td>
                    <td>${player.isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : 'üî¥ –û—Ñ–ª–∞–π–Ω'}</td>
                    <td>${player.isAdmin ? 'üëë –ê–¥–º–∏–Ω' : 'üë§ –ò–≥—Ä–æ–∫'}</td>
                    <td>
                        <button class="admin-btn" onclick="setChips('${player.name}')">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });

        socket.on('admin-rooms-list', (rooms) => {
            const tbody = document.getElementById('roomsTableBody');
            tbody.innerHTML = '';
            
            if (rooms.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–æ–ª–æ–≤</td></tr>';
                return;
            }
            
            rooms.forEach(room => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${room.roomId}</td>
                    <td>${room.playersCount}</td>
                    <td>${room.state}</td>
                    <td>
                        <button class="admin-btn admin-btn-danger" onclick="deleteRoom('${room.roomId}')">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });

        socket.on('admin-success', (message) => {
            showMessage(message, 'success');
        });

        socket.on('admin-error', (message) => {
            showMessage(message, 'error');
        });

        function showMessage(message, type) {
            adminMessage.innerHTML = `<div class="admin-message ${type}">${message}</div>`;
            setTimeout(() => {
                adminMessage.innerHTML = '';
            }, 5000);
        }

        function loadPlayers() {
            if (!isAdminAuthenticated) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å', 'error');
                return;
            }
            socket.emit('admin-get-players');
        }

        function loadRooms() {
            if (!isAdminAuthenticated) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å', 'error');
                return;
            }
            socket.emit('admin-get-rooms');
        }

        function setChips(playerName) {
            const input = document.getElementById(`chips_${playerName}`);
            const chips = parseInt(input.value);
            if (isNaN(chips) || chips < 0) {
                showMessage('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏—à–µ–∫', 'error');
                return;
            }
            socket.emit('admin-set-chips', { playerName, chips });
        }

        function deleteRoom(roomId) {
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª ${roomId}?`)) {
                socket.emit('admin-delete-room', { roomId });
                setTimeout(() => loadRooms(), 1000);
            }
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            loadPlayers();
            loadRooms();
        }, 10000);
    </script>
</body>
</html>

